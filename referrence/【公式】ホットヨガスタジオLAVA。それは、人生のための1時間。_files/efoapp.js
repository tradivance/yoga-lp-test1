function arrayToString(e,t){return Array.isArray(t)?e==g_input_types.pulldown?t.join(" - "):e==g_input_types.input?t.join(" "):t.join(","):t}function initNoPersistVarsIfNeed(){no_persist_list||(no_persist_list={}),no_persist_answers||(no_persist_answers={}),arr_input_types||(arr_input_types=[g_input_types.checkbox,g_input_types.radio])}function setToNoPersistList(e,t){initNoPersistVarsIfNeed(),e&&t&&(no_persist_list[e]=t)}function getPulldownValues(e,t){var n=[];if(Array.isArray(e)&&Array.isArray(t)&&t.length==e.length){var r=0;for(r=0;r<e.length;r++){var a=t[r],s=void 0;try{s=e[r][a]}catch(e){s=void 0}s&&(s.value?n.push(s.value):s.text?n.push(s.text):n.push(s))}}return n}function noPersistValueToSave(e,t,n,r){initNoPersistVarsIfNeed();var a={};e&&(a.type=e),t&&(a.templateType=t);var s=no_persist_list[n];if(Array.isArray(r)&&r.length>0&&s)if(arr_input_types.includes(e)){for(var i=[],o=0;o<r.length;o++){var c=s[r[o]];i.push(c.value?c.value:c)}a.answer=i}else e==g_input_types.pulldown&&(a.answer=getPulldownValues(s,r));return a.answer||(a.answer=r),a}function saveNoPersistValue(e,t,n,r){const a=noPersistValueToSave(e,t,n,r);no_persist_answers[n]=a}function getNoPersistRawValue(e){var t="";return e&&e.answer&&(t=e.answer),t||""}function getDateString(e){var t="";if(e){var n=e.year,r=e.month,a=e.day;n&&r&&a&&(t=n+"-"+r+"-"+a)}return t}function getNoPersistValue(e){var t="";switch(e.type){case g_input_types.input:case g_input_types.textarea:case g_input_types.pulldown:case g_input_types.radio:case g_input_types.checkbox:t=arrayToString(e.type,e.answer);break;case g_input_types.calendar:if(Array.isArray(e.answer)){if(2==e.answer.length){var n=getDateString(e.answer[0]),r=getDateString(e.answer[1]);n&&r&&(t=(t=n+" ～ "+r).replaceAll("-","/"))}}else t=getDateString(e.answer);break;case g_input_types.postal_code:var a=e.answer.postal_code,s=e.answer.prefectures||"",i=e.answer.municipality||"",o=e.answer.street_number||"",c=e.answer.building_name||"";a&&(t="〒"+a+" "),t+=s+i+o+c}return t||""}function getElementData(e,t){return e&&e.data&&e.data(t)?e.data(t).toString():null}function setInputWithVariableValue(e,t,n,r,a){if(e){var s="";if(r?s="checkbox"==n?getNoPersistRawValue(r):getNoPersistValue(r):a&&(s=a),"radio"==n||"checkbox"==n){if(!("checkbox"!=n||s&&s.includes))return;var i=e.querySelectorAll(t);try{i.length>0&&i.forEach(function(e){("radio"==n&&e.value==s||"checkbox"==n&&s.includes(e.value))!=e.checked&&e.click()})}catch(e){}}else{var o=e.querySelector(t);if(o)[window.HTMLInputElement,window.HTMLSelectElement,window.HTMLTextAreaElement].indexOf(o.__proto__.constructor)>-1?Object.getOwnPropertyDescriptor(o.__proto__,"value").set.call(o,s):o.value=s}}}function submitFormAssist(e,t,n){if(e.id||e.name||e.selector||Array.isArray(t)){var r;r=e.id?'form[id="'+e.id+'"]':e.name?'form[name="'+e.name+'"]':e.selector;var a=document.querySelector(r);if(a){var s=0;for(s=0;s<t.length;s++){var i=t[s];if((i.id||i.name)&&i.input&&(i.answer||i.value)){var o=i.input+(i.id?'[id="'+i.id+'"]':'[name="'+i.name+'"]');try{var c="";i.answer&&(c=JSON.parse(i.answer)),setInputWithVariableValue(a,o,i.type,c,i.value)}catch(e){}}}n||(setTimeout(function(){btag("event","close")},3e3),setTimeout(function(){a.submit()},5e3))}}}function generateFormAssistScript(e){var t="";if(e.form&&(e.form.id||e.form.name||e.form.selector)){var n=e.form;if(t+=n.id?'var form = {id: "'+n.id+'"};\n':n.name?'var form = {name: "'+n.name+'"};\n':'var form = {selector: "'+n.selector+'"};\n',t+="var elements = [];\n",Array.isArray(e.elements)){var r=0;for(r=0;r<e.elements.length;r++){var a=e.elements[r],s=no_persist_answers?no_persist_answers[a.variableId]:"";if(s)try{s=JSON.stringify(s)}catch(e){s=""}else s="";var i=a.value;i||(i=""),a.name&&a.input&&a.variableId&&(t+="elements.push({name: '"+a.name+"', input: '"+a.input+"', answer: '"+s+"', value: '"+i+"', ",a.type&&(t+="type: '"+a.type+"', "),t+="variableId: '"+a.variableId+"'});\n")}}t+=1==e.is_not_submitting?"submitFormAssist(form, elements, true);\n":"submitFormAssist(form, elements, false);\n"}return t}function efoInit(e,t,n,r,a,s){if(void 0!=e)try{var i="https://app.botchan.chat",o="https://app2.blob.core.windows.net/botchan/",c=document.createElement("link"),u=o+"css/efo.css?v=5.1.316";2==a&&(u=i+"/efo/design-type-url?v=5.1.316&connect_page_id="+e+"&chat_storage_url="+o),c.setAttribute("rel","stylesheet"),c.setAttribute("href",u);var l=document.createElement("script");l.setAttribute("type","text/javascript"),l.setAttribute("src",o+"js/efo.js?v=5.1.316"),document.body.appendChild(c),document.body.appendChild(l),l.onload=function(){embot_init(i+"/efo",e,t,n,r,s)}}catch(e){}}function efoPreviewInit(e,t,n,r,a,s,i){if(document.getElementById("wc-webchat-box-ctn")&&document.getElementById("wc-webchat-box-ctn").parentElement.classList.add("hidden_force"),t&&"string"==typeof t&&"generate_from_url"==e){const e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({page_url:t,create_bot_preview_flag:1})};fetch("https://api.botchan.chat/api/generate-scenarios",e).then(function(e){return e.text()}).then(function(e){const t=JSON.parse(e).connect_page_id;t?(initPreviewBox(t,n,r,a,s),i({success:!0,connect_page_id:t})):i({success:!1})}).catch(function(e){i({success:!1})})}else"0"==e?(initPreviewBox("622eefb90129e05296e30e1c",n,r,a,s),i({success:!0})):(initPreviewBox(e,n,r,a,s),i({success:!0}))}function initPreviewBox(e,t,n,r,a){try{var s=!1;const c="https://app2.blob.core.windows.net/botchan/";document.getElementById("wc-webchat-box-ctn")&&(s=!0,document.getElementById("wc-webchat-box-ctn").parentElement.remove()),document.getElementById("chatbbot_css")&&document.getElementById("chatbbot_css").remove(),document.getElementById("chatbbot_js")&&document.getElementById("chatbbot_js").remove();const u=c+"efo_v2_design_type/"+r+"/efo.style.css?v=5.1.316";var i=document.createElement("link");if(i.setAttribute("id","chatbbot_css"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",u),document.body.appendChild(i),!document.getElementById("chatbbot_js")){var o=document.createElement("script");o.setAttribute("id","chatbbot_js"),o.setAttribute("type","text/javascript"),o.setAttribute("src",c+"js/efo.js?v=5.1.316"),document.body.appendChild(o),o.onload=function(){embot_create_bot_preview_init("https://app.botchan.chat/efo/create-bot-preview",s,e,1,1,null,null,a,r,t,n)}}}catch(e){}}function efoPreviewScenarioInit(e,t,n,r,a,s,i){if(void 0!=e)try{var o="https://app.botchan.chat",c="https://app2.blob.core.windows.net/botchan/",u=document.createElement("link"),l=c+"css/efo.css?v=5.1.316";2==a&&(l=o+"/efo/design-type-url?v=5.1.316&connect_page_id="+e+"&chat_storage_url="+c),u.setAttribute("rel","stylesheet"),u.setAttribute("href",l);var p=document.createElement("script");p.setAttribute("type","text/javascript"),p.setAttribute("src",c+"js/efo.js?v=5.1.316"),document.body.appendChild(u),document.body.appendChild(p),p.onload=function(){previewScenarioInit(o+"/efo",e,t,n,r,s,a,i)}}catch(e){}}var arr_input_types,no_persist_list,no_persist_answers,g_input_types={text:"001",input:"002",textarea:"003",radio:"004",checkbox:"005",pulldown:"006",postal_code:"007",file:"008",calendar:"009",terms_of_use:"010",confirmation:"011",carousel:"012",card_payment:"013",captcha:"014",add_to_cart:"015",request_document:"016",product_purchase:"017",button_confirm:"019",pulldown_checkbox_stress:"111",pulldown_checkbox_station:"112",pin_code_auth_flg:"020"};